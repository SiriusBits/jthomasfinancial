---
import { ChevronDown } from '@/icons/lucide-icons';

interface Props {
  service: {
    id: string;
    title: string;
    slug: string;
    shortDescription: string;
    icon: string;
    image?: string;
  };
  icon: import('astro').Component;
}

const { service, icon: IconComponent } = Astro.props;
const hasLongContent = Astro.slots.has('expandable');
---

<div
  class="service-accordion rounded-lg border border-slate-200 bg-white shadow-sm overflow-hidden"
  data-service-id={service.slug}
>
  <h3 class="font-heading font-semibold text-navy text-lg px-5 pt-5 pb-2 flex items-center gap-3">
    <span class="flex shrink-0 rounded-lg bg-gold/10 p-2 text-gold">
      <IconComponent size={22} class="text-current" />
    </span>
    {service.title}
  </h3>
  <div class="px-5 pb-4 flex gap-4 items-start">
    {service.image && (
      <div class="w-[180px] h-[120px] shrink-0 overflow-hidden rounded-md">
        <img
          src={service.image}
          alt=""
          class="h-full w-full object-cover"
          width="180"
          height="120"
        />
      </div>
    )}
    <div class="min-w-0 flex-1 flex flex-col gap-4">
      <p class="text-neutral-600 text-sm">{service.shortDescription}</p>
      {hasLongContent && (
        <button
          type="button"
          class="service-accordion-trigger inline-flex items-center gap-2 font-body font-medium text-navy border-2 border-navy rounded px-4 py-2 text-sm hover:bg-navy hover:text-white transition-colors w-fit focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gold"
          data-accordion-trigger
          aria-expanded="false"
          aria-controls={`accordion-content-${service.slug}`}
          id={`accordion-trigger-${service.slug}`}
        >
          <span data-trigger-text>Learn more</span>
          <ChevronDown size={16} class="transition-transform duration-300 ease-in-out" data-chevron aria-hidden="true" />
        </button>
      )}
    </div>
  </div>
  {hasLongContent && (
    <div
      class="grid transition-[grid-template-rows] duration-300 ease-in-out [grid-template-rows:0fr]"
      data-accordion-wrapper
    >
      <div class="overflow-hidden">
        <div
          class="service-accordion-content px-5 pb-5 pt-3 text-neutral-600 text-sm leading-relaxed prose prose-slate prose-p:mb-4 prose-p:last:mb-0 prose-p:text-sm [&_h1]:hidden border-t border-slate-200"
          data-accordion-content
          id={`accordion-content-${service.slug}`}
        >
          <slot name="expandable" />
        </div>
      </div>
    </div>
  )}
</div>
